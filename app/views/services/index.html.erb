<header class="p-4">
  <p class="m-0">Services</p>
  <div>
    <a id="expan_all" class="btn" onclick="collapseAll();">
      <i class="small material-icons">expand_more</i>
    </a>
    <a id="collapse_all" class="btn" onClick="expandAll();">
      <i class="small material-icons">expand_less</i>
    </a>
  </div>
  <div>
    <a class='dropdown-trigger btn' href='#' data-target='dropdown-header'>Add New</a>

    <!-- Dropdown Structure -->
    <ul id='dropdown-header' class='dropdown-content auto'>
      <li><%= link_to 'Service', new_service_path %></li>
      <li class="divider" tabindex="-1"></li>
      <li><%= link_to 'Category', new_service_category_path(format: :js), remote: true %></li>
    </ul>
  </div>

</header>

<div id="services-index" class="main-section">
  <div class="row">
    <div class="col s8 push-s2">
      <% @categories.map do |category| %>
        <div class="category-header">
          <h5 class="main-color"> <%= category.name %></h5>
          <div>
            <a class='dropdown-trigger secondary-bg btn-small' href='#' data-target='dropdown<%= category.id %>'>
              <i class="material-icons">menu</i>
            </a>
            <ul id='dropdown<%= category.id %>' class='dropdown-content auto'>
              <li>
                <%= link_to 'Add Service', new_service_path(category_id: category.id) %>
              </li>
              <li>
                <%= link_to 'Edit Category', edit_service_category_path(id: category.id,format: :js), remote: true %>
              </li>
              <li class="divider" tabindex="-1"></li>
              <li>
                <%= link_to 'Delete Category', service_category_path(id: category.id),
                            data: {:confirm => 'Are you sure?'}, class: 'waves-effect waves-red red-text', :method => :delete%>
              </li>
            </ul>
          </div>
        </div>
        <ul class="collapsible">
          <% service_by_category(@services, category).map do |service| %>
            <li style=" border-left: 5px solid <%= category.appointment_color %>">
              <div class="collapsible-header">
                <div>
                  <i class="material-icons">menu</i><%= service.name %>
                </div>
                <a href="/services/<%= service.id %>/edit">
                  <i class="tiny material-icons">edit</i>
                </a>
              </div>
              <div class="collapsible-body">
                <table class="white">
                  <thead>
                  <tr>
                    <th class="p-2"> Option</th>
                    <th class="p-2"> Duration</th>
                    <th class="p-2"> Price</th>
                  </tr>
                  </thead>
                  <tbody>
                  <% service.service_prices.map do |service_price| %>
                    <tr>
                      <td class="p-2">
                        <%= service_price.name %>
                      </td>
                      <td class="p-2">
                        <%= service_price.duration %> min
                      </td>
                      <td class="p-2">
                        KWD <%= service_price.price %>
                      </td>
                    </tr>
                  <% end %>
                  </tbody>
                </table>
              </div>
            </li>
          <% end %>
        </ul>
        <div class="divider"></div>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript" charset="utf-8">
    function expandAll() {
        $('.collapsible').collapsible('close');
    }
    function collapseAll() {
        $('.collapsible').collapsible('open');

    }
</script>